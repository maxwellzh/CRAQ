# QQ聊天记录消息文本搜索

## 介绍

检索出某段时间内聊天记录内某关键词出现次数，及每个发言成员发言中出现该词次数.

开发环境 Python `3.7.5`

目前仅支持`.txt`文本格式，使用帮助

```bash
$ python3 craq.py -h
usage: craq.py [-h] [-i in-file [in-file ...]] [-m out-file] [-v]

QQ消息文本搜索[20210101]

optional arguments:
  -h, --help            显示当前信息.
  -i in-file [in-file ...]
                        指定输入文件，只添加-i参数时进入菜单模式（推荐）.
  -m out-file           整合消息记录.
  -v, --version         显示当前程序版本

获取更详细帮助信息：https://github.com/maxwellzh/CRAQ/blob/master/README.md
```

- `-i`指定输入文件位置，除打印帮助信息外为必须选项；只有该选项时会进入菜单模式；可使用` `（空格）连接多个文件或正则式同时处理，如

  ```bash
  $ python3 craq.py -i .\file1.txt .\file2.txt
  $ python3 craq.py -i *.txt
  ```

- `-m`可将输入文件整合（按时间顺序）为一个文件，若文件不存在则会新建，**文件已存在会覆盖！**


### 菜单模式

```shell
$ python3 craq.py -i talk.txt
Reading...
talk.txt: |███████████████████████████████████████████████████████████ | 群员数: 71 消息数: 481167
交互模式
usage: craq.py [-h] [-t time] [-k word] [-r pattern] [-a] [-m] [-n name|ID] [-e]

optional arguments:
  -h, --help  显示当前信息.
  -t time     在指定日期范围内搜索，示例：1.190611 2.<date begin>[:<date end>]
  -k word     指定关键词，不可与-r共同使用.
  -r pattern  使用正则表达式搜索，不可与-k共同使用.
  -a          统计所有信息，会覆盖其他参数（-k -r -t）.
  -m          按照成员发言数输出（默认为按日期输出）.
  -n name|ID  查询特定用户发言.
  -e          退出（或Ctrl+c）.
>>>
```

- `-t`参数支持多种格式，也可以使用相对时间表示，以下用法都是被接受的：

  ```shell
  > -t :191105
  > -t 191105
  > -t 190520:
  > -t +30:-15
  > -t 190510:190510+10
  ```

## 使用示例

### 菜单模式

默认按时间轴显示

```shell
>>> -k 猪 -t 191115-6:
------------------------------------------------------------------------------------
          2019-11-9:2020-3-22期间检索到关键词'猪'271次                日期       次数
------------------------------------------------------------------------------------
                                                                  2019-11-09    0
                                                           ███    2019-11-10    2
                                                  ████████████    2019-11-11    8
                                                          ████    2019-11-12    3
                                        ...
                                                ██████████████    2020-03-17    9
------------------------------------------------------------------------------------
>>> 
```

添加参数`-m`后按成员显示

```shell
>>> -k 猪 -t 191115-6: -m
------------------------------------------------------------------------------
          2019-11-9:2020-3-22期间检索到关键词'猪'271次             次数    昵称
------------------------------------------------------------------------------
  ████████████████████████████████████████████████████████████    79    xxx
       ███████████████████████████████████████████████████████    73    xxx
                                                 █████████████    18    xxx
                                                  ████████████    16    xxx
                                                    ██████████    14    xxx
                                                       ███████    10    xxx
                                                         █████    7     xxx
                                                           ███    4     其他
------------------------------------------------------------------------------

>>> 
```

使用正则表达式搜索示例（搜索任意长度为12的数字并按照成员发言数输出）

```shell
>>> -r '\d{12}' -m
------------------------------------------------------------------------------
        2019-5-14:2020-3-22期间检索到正则式'\d{12}'101次          次数    昵称
------------------------------------------------------------------------------
  ████████████████████████████████████████████████████████████    10    xxx
        ██████████████████████████████████████████████████████    9     xxx
              ████████████████████████████████████████████████    8     xxx
              ████████████████████████████████████████████████    8     xxx
              ████████████████████████████████████████████████    8     xxx
                          ████████████████████████████████████    6     xxx
                          ...
                                                                  0     其他
------------------------------------------------------------------------------
>>> 
```

## To do

- [ ] 制作GUI
- [x] 添加正则表达式搜索
- [ ] 如何让代码更优雅
- [ ] ~~添加成员行为统计（按时间段）~~(已完成但需要matplotlib包打包后体积太大因此不打算在留master分支)

## P.S

如何导出QQ聊天记录：

### Windows

1. 打开任意聊天界面
2. - **TIM：** 输入文本框右上角点击“消息管理”，再选择”消息管理器“
   - **QQ：** 将鼠标指针移动至输入文本框右上角”···“处，选择”消息管理器“
3. 列表内右击群组/个人，选择“导出消息聊天记录”
4. 保存为`.txt`格式

### MacOS/Linux/Mobile OS

not support

## Use a new method to read file

Testbench: read ~500w lines of text

new method: time=13.860681s

old method: time=16.610630s
